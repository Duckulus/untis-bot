version: "3"
services:
  server:
    image: duckulus/untis-bot
    build:
      context: .
      dockerfile: ./apps/server/Dockerfile
    volumes:
      - ./apps/server/.wwebjs_auth:/app/apps/server/.wwebjs_auth
      - ./packages/db/prisma:/app/packages/db/prisma
    deploy:
      restart_policy:
        condition: on-failure
        max_attempts: 10

  web:
    build:
      context: .
      dockerfile: ./apps/web/Dockerfile
      args:
        - NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL}
        - NEXT_PUBLIC_FRONTEND_URL=${NEXT_PUBLIC_FRONTEND_URL}

    deploy:
      restart_policy:
        condition: on-failure
        max_attempts: 10

  redis:
    image: "redis:alpine"
    ports:
      - "6379:6379"
